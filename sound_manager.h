//--------------------------------------------------------------------------------
//　sound_manager.h
//  manage the se,bgm's save, load
//  サウンド管理者
//  Author : 徐文杰(KodFreedom)
//--------------------------------------------------------------------------------
#pragma once
#include <XAudio2.h>
#include "common_setting.h"

//--------------------------------------------------------------------------------
//  列挙型定義
//--------------------------------------------------------------------------------
enum SoundLabel
{
    eGameBGM,
    eSoundMax,
};

//--------------------------------------------------------------------------------
//  サウンド管理者クラス
//--------------------------------------------------------------------------------
class SoundManager final
{
public:
    //--------------------------------------------------------------------------------
    //  生成処理
    //  return : SoundManager*
    //--------------------------------------------------------------------------------
    static SoundManager* Create(void)
    {
        auto instance = MY_NEW SoundManager();
        instance->Init();
        return instance;
    }

    //--------------------------------------------------------------------------------
    //  破棄処理
    //--------------------------------------------------------------------------------
    void Release(void);

    //--------------------------------------------------------------------------------
    //  指定したサウンドを鳴らす
    //  label : soundのラベル
    //--------------------------------------------------------------------------------
    void Play(const SoundLabel label);

    //--------------------------------------------------------------------------------
    //  指定したサウンドを止める
    //  label : soundのラベル
    //--------------------------------------------------------------------------------
    void Stop(const SoundLabel label);

    //--------------------------------------------------------------------------------
    //  指定したサウンドが終わってるかをチェック
    //  label : soundのラベル
    //--------------------------------------------------------------------------------
    bool IsOver(const SoundLabel label);

    //--------------------------------------------------------------------------------
    //  指定したサウンドがなってるかをチェック
    //  label : soundのラベル
    //--------------------------------------------------------------------------------
    bool IsPlaying(const SoundLabel label);

    //--------------------------------------------------------------------------------
    //  全てのサウンドを止まる
    //--------------------------------------------------------------------------------
    void StopAll(void);

private:
    //--------------------------------------------------------------------------------
    //　構造体定義
    //--------------------------------------------------------------------------------
    struct Paramater
    {
        String    file_path;
        int       count_loop;
    };

    //--------------------------------------------------------------------------------
    //  constructors and destructors
    //--------------------------------------------------------------------------------
    SoundManager();
    SoundManager(const SoundManager& value) {}
    SoundManager& operator=(const SoundManager& value) {}
    ~SoundManager() {}

    //--------------------------------------------------------------------------------
    //  初期化処理
    //--------------------------------------------------------------------------------
    bool Init(void);

    //--------------------------------------------------------------------------------
    //  終了処理
    //--------------------------------------------------------------------------------
    void Uninit(void);

    //--------------------------------------------------------------------------------
    //  マルチスレッド処理
    //--------------------------------------------------------------------------------
    void Run(void);

    //--------------------------------------------------------------------------------
    //  チャンクのチェック
    //--------------------------------------------------------------------------------
    bool CheckChunk(HANDLE file, DWORD format, DWORD& chunk_size, DWORD& chunk_data_position);

    //--------------------------------------------------------------------------------
    //  チャンクデータの読み込み
    //--------------------------------------------------------------------------------
    bool ReadChunkData(HANDLE file, void *buffer, DWORD buffer_size, DWORD buffer_offset);

    //--------------------------------------------------------------------------------
    //  変数定義
    //--------------------------------------------------------------------------------
    thread*                  thread_ = nullptr;
    IXAudio2*                instance_xaudio2_ = nullptr;
    IXAudio2MasteringVoice*  mastering_voice_ = nullptr;
    IXAudio2SourceVoice*     source_voices_[eSoundMax] = { 0 };
    BYTE*                    audio_datas_[eSoundMax] = { 0 };
    DWORD                    audio_sizes_[eSoundMax] = { 0 };
    bool                     is_running_ = true;
    static Paramater         paramaters_[eSoundMax];
};