//--------------------------------------------------------------------------------
//	アクター
//　gameObjectActor.h
//	Author : Xu Wenjie
//--------------------------------------------------------------------------------
#include "game_object_actor.h"
#include "animator.h"

//--------------------------------------------------------------------------------
//
//  Public
//
//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
//  コンストラクタ
//--------------------------------------------------------------------------------
GameObjectActor::GameObjectActor(const Layer& layer)
	: GameObject(layer)
{
	animator_ = MY_NEW Animator(*this);
}

//--------------------------------------------------------------------------------
//  初期化
//--------------------------------------------------------------------------------
bool GameObjectActor::Init(void)
{
	GameObject::Init();
	animator_->Init();
	return true;
}

//--------------------------------------------------------------------------------
//  更新
//--------------------------------------------------------------------------------
void GameObjectActor::Update(void)
{
	if (!is_active_) return;
	GameObject::Update();
}

//--------------------------------------------------------------------------------
//  更新
//--------------------------------------------------------------------------------
void GameObjectActor::LateUpdate(void)
{
	if (!is_active_) return;
    rigidbody_->LateUpdate();
    for (auto& pair : behaviors_) { pair.second->LateUpdate(); }
    animator_->Update();
    transform_->UpdateMatrix();
    for (auto renderer : renderers_) { renderer->Update(); }
	animator_->LateUpdate();
}

//--------------------------------------------------------------------------------
//
//  Private
//
//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
//  終了処理
//--------------------------------------------------------------------------------
void GameObjectActor::Uninit(void)
{
	GameObject::Uninit();
	SAFE_RELEASE(animator_);
}